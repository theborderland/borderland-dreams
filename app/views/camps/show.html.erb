<div class="row">
    <div class="col-md-8">
        <h1 class="header-sub-heading"><%= @camp.name %></h1>
    </div>
</div>

<div class="row">

    <div class="col-md-8">

        <!-- Blueimp Gallery -->
        <div id="blueimp-gallery" class="blueimp-gallery">
            <div class="slides"></div>
            <h3 class="title"></h3>
            <a class="prev">‹</a>
            <a class="next">›</a>
            <a class="close">×</a>
            <a class="play-pause"></a>
            <ol class="indicator"></ol>
        </div>

        <div id="links">
            <% @camp.images.each_with_index do |image, index| %>
                <% status = "" %>
                <% if index == 0 %>
                    <% status = "active" %>
                <% end %>
                <% image_url = image.attachment.url(:large)%>

                <div class="thumbnail">
                    <a href="<%= image_url %>">
                        <img src="<%= image_url %>">
                    </a>
                </div>

            <% end %>

        </div>

        <% content_for(:head) do %>
            <% browser_title = @camp.name + " - " + t(:browser_title_tag) %>
            <title><%= browser_title %></title>
            <%= javascript_include_tag 'blueimp_script' %>
        <% end %>

        <!-- Creation text content -->
        <div class="camp-description">
            <b><%=t :form_summary %></b>
            <p><%= simple_format(@camp.subtitle) %></p>
        </div>

        <% if Rails.configuration.x.firestarter_settings["description"] and @camp.description.present? %>
            <div class="camp-description">
                <b><%=t :form_description_label %></b>
                <p><%= simple_format(@camp.description) %></p>
            </div>
        <% end %>

        <% if Rails.configuration.x.firestarter_settings["plan"] and @camp.plan.present? %>
            <div class="camp-description">
                <b><%=t :form_plan_label %></b>
                <p><%= simple_format(@camp.plan) %></p>
            </div>
        <% end %>

        <% if Rails.configuration.x.firestarter_settings["moop"] and @camp.moop.present? %>
            <div class="camp-description">
                <b><%=t :form_moop_label %></b>
                <p><%= simple_format(@camp.moop) %></p>
            </div>
        <% end %>

        <% if Rails.configuration.x.firestarter_settings["recycling"] and @camp.recycling.present? %>
            <div class="camp-description">
                <b><%=t :form_recycling_label %></b>
                <p><%= simple_format(@camp.recycling) %></p>
            </div>
        <% end %>

        <% if Rails.configuration.x.firestarter_settings["budgetplan"] and @camp.budgetplan.present? %>
            <div class="camp-description">
                <b><%=t :form_budgetplan_label %></b>
                <p><%= simple_format(@camp.budgetplan) %></p>
            </div>
        <% end %>

        <% if Rails.configuration.x.firestarter_settings["cocreation"] and @camp.cocreation.present? %>
            <div class="camp-description">
                <b><%=t :form_cocreation_label %></b>
                <p><%= simple_format(@camp.cocreation) %></p>
            </div>
        <% end %>

    </div> <!-- col-md-8 -->

    <div class="col-md-4">

        <% if !user_signed_in? and Rails.configuration.x.firestarter_settings["creation_sidebar_welcome"] %>
            <div class="panel panel-default">
                <div class="panel-heading"><%=t :what_is_this_title %></div>
                <div class="panel-body">
                    <p><%=t :what_is_this_text_html %></p>
                </div>
            </div>
        <% end %>

        <% if !current_user || @camp.creator != current_user %>
            <% random = Camp.order("RANDOM()").first %>
            <a href="<%= url_for(random) %>" class="btn btn-primary camp-button" role="button">
                <%=t :next_random_dream %> <span class="glyphicon glyphicon-random" aria-hidden="true"></span>
            </a>
        <% end %>    

        <div class="creation-info">
            <ul>

                <li><span><h2 class="header-sub-heading"><%=t :creation_info_headline %></h2></span></li>

                <% if current_user && @camp.creator == current_user %>
                    <li><span>
                        <a href="<%= edit_camp_path(@camp) %>" class="btn btn-primary camp-button" role="btn button"><%=t :edit_dream %></a>
                    </li></span>
                    <li><span>
                        <a href="<%= camp_images_path(@camp) %>" class="btn btn-primary camp-button" role="btn button"><%=t :manage_images %></a>
                    </li></span>
                <% end %>

                <br>

                <li><span><b><%=t :contact_name%>:</b> <%= @camp.contact_name %></span></li>
                <br>

                <% if current_user && current_user.guide %>
                    <li><span><b><%=t :contact_email %>:</b> <%= @camp.contact_email %></span></li>

                    <br>
                <% end %>

                <!-- Granting system -->
                <% if @camp.grantingtoggle %>
                    <% button_text = t(:turn_off_granting) %>
                <% else %>
                    <% button_text = t(:enable_granting) %>
                <% end %>

                <% if current_user && (current_user.guide || current_user.admin) %>
                    <%= form_tag({controller: "camps", action: "toggle_granting"}, method: "patch") do %>
                        <%= submit_tag button_text, :class => "btn btn-danger" %>
                    <% end %>
                <% end %>

                <!-- Granting system -->
                <% if Rails.configuration.x.firestarter_settings["granting_active"] and @camp.minbudget %>

                    <li><span>

                        <% if @camp.minbudget <= @camp.grants_received and @camp.maxbudget > 0 %>
                            <% if @camp.maxbudget <= @camp.grants_received %>
                                <h3><span class="label label-success granting-label">
                                    <b><%=t :fully_funded %></b>
                                </span></h3>
                            <% else %>
                                <h3><span class="label label-success granting-label">
                                    <b><%=t :minimum_funding_reached %></b>
                                </span></h3>
                            <% end %>
                        <% else %>
                            <h3><span class="label label-warning granting-label">
                                <b><%=t :not_funded_yet %></b>
                            </span></h3>
                        <% end %>

                        <h3><span class="label label-info granting-label">
                            <b><%=t :minimum_grants_needed %></b>
                            <span class="badge"><%= @camp.minbudget %></span>
                        </span></h3>

                        <h3><span class="label label-info granting-label">
                            <b><%=t :needed_to_fully_fund %></b>
                            <span class="badge"><%= @camp.maxbudget %></span>
                        </span></h3>

                        <h3><span class="label label-info granting-label">
                            <b><%=t :grants_recieved %> </b>
                            <span class="badge"><%= @camp.grants_received %></span>
                        </span></h3>

                        <!-- Show user grants left -->
                        <% if current_user and @camp.minbudget %>
                            <% if current_user.grants > 0 %>
                                <h3><span class="label label-success granting-label">
                                    <b><%=t :your_available_grants %> </b>
                                    <span class="badge"><%= current_user.grants %></span>
                                </span></h3>
                            <% else %>
                                <h3><span class="label label-warning granting-label">
                                    <b><%=t :youre_out_of_grants %> </b>
                                </span></h3>
                            <% end %>
                        <% end %>

                        <!-- If user grants are > 0, allow user to asign them -->
                        <!-- Show a form with a drop-down containing user grants -->
                        <!-- Current iteration shows a number field -->

                        <% if @camp.grantingtoggle %>
                            <% if current_user && current_user.grants > 0 && !@camp.fullyfunded %>
                                <h3><span class="label label-primary granting-label">
                                    <%= form_tag({controller: "camps", action: "update_grants"}, method: "patch") do %>
                                        <%= label_tag t(:give_grants) %>
                                        <%= number_field_tag 'grants', nil, in: 0..current_user.grants, step: 1 %>
                                        <%= submit_tag t(:i_gift_thee_grants), :class => "btn btn-success" %>
                                    <% end %>
                                </span></h3>
                            <% end %>
                        <% else %>
                            <h3><span class="label label-warning granting-label">
                                <b> <%=t :no_granting_yet %></b>
                            </span></h3>
                        <% end %>

                        <br>
                <% end %>
                <!-- End of granting block -->

                <% if Rails.configuration.x.firestarter_settings["electricity"] and @camp.electricity.present? %>
                    <li><span>
                        <b><%=t :form_electricity_label %></b> <%= @camp.electricity %>
                    </span></li>


                    <br>
                <% end %>

                <% if Rails.configuration.x.firestarter_settings["light"] and  @camp.light.present? %>
                    <li><span>
                        <b><%=t :form_light_label %></b> <%= @camp.light %>
                    </span></li>


                    <br>
                <% end %>

                <% if Rails.configuration.x.firestarter_settings["fire"] and  @camp.fire.present? %>
                    <li><span>
                        <b><%=t :form_fire_label %></b> <%= @camp.fire %>
                    </span></li>


                    <br>
                <% end %>

                <% if Rails.configuration.x.firestarter_settings["noise"] and  @camp.noise.present? %>
                    <li><span>
                        <b><%=t :form_noise_label %></b> <%= @camp.noise %>
                    </span></li>


                    <br>
                <% end %>

                <% if Rails.configuration.x.firestarter_settings["nature"] and  @camp.nature.present? %>
                    <li><span>
                        <b><%=t :form_nature_label %></b> <%= @camp.nature %>
                    </span></li>


                    <br>
                <% end %>

                <% if Rails.configuration.x.firestarter_settings["grants"] and  @camp.minbudget.present? %>
                    <li><span>
                        <b><%=t :form_minigrants_label %></b> <%= @camp.minbudget %>
                    </span></li>
                <% end %>

                <% if Rails.configuration.x.firestarter_settings["grants"] and  @camp.maxbudget.present? %>
                    <li><span>
                        <b><%=t :form_maxigrants_label %></b> <%= @camp.maxbudget %>
                    </span></li>


                    <br>
                <% end %>

                <% if Rails.configuration.x.firestarter_settings["add_to_list"] %>
                    <br>
                    <% if @camp.creator != current_user %>
                        <li><b><%=t :cocreator_application_guidetext %></b></li>
                        <div class="join_creation">
                            <%= button_to t(:add_my_name), {action: "join", user: current_user }, {class: 'btn btn-success button'} %>
                        </div>
                    <% end %>

                    <% if current_user && (@camp.creator == current_user || current_user.guide) %>
                        <br>
                        <li><span><b><%=t :cocreators_list_guidetext %></b>
                            <% @users.each do |user| %>
                                <%= user.email %><br>
                            <% end %>
                        </span></li>
                    <% end %>
                <% end %>

                <% if current_user && (@camp.creator == current_user || current_user.admin) %>
                    <%= form_for @camp, method: :delete do |f| %>
                        <%= f.submit t(:delete_this_creation), class: "btn btn-danger" , data: { confirm: t(:are_you_sure) } %>
                    <% end %>
                <% end %>

            </ul>

        </div> <!-- creation-info -->

    </div> <!-- col-md-3 -->

</div> <!-- row -->
